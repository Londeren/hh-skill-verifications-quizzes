## Docker — средний уровень

#### Содержание

- Управление Docker образами и контейнерами
- Управление данными в Docker контейнерах
- Организация мониторинга и логирования

#### Вы запускаете команду `docker pull my_registry/my_image:latest`, но образ не загружается, и выводится ошибка. В результате другие контейнеры, которые зависят от этого образа, не могут быть запущены, что вызывает сбои в работе приложения.

Какая причина могла привести к этой ошибке?

- [ ] Неправильный тег образа в команде, который не соответствует имеющимся в реестре версиям
- [ ] Ограниченные сетевые настройки Docker, запрещающие взаимодействие с внешними реестрами
- [x] Неправильные данные авторизации при доступе к приватному реестру, что заблокировало загрузку образа
- [ ] Отсутствие соединения с интернетом на сервере, из-за чего команда `pull` не выполняется
- [ ] Использование неверного флага `--auth` для авторизации в реестре

#### Вы работаете над Dockerfile для создания образа микросервисного приложения. Во время тестирования вы обнаружили следующие проблемы:

Размер образа слишком велик и его загрузка занимает много времени. Во время работы контейнера возникают ошибки, связанные с отсутствием необходимых пакетов. Сборка занимает значительно больше времени из-за повторной установки зависимостей.
Что поможет исправить все эти ошибки в структуре Dockerfile?

- [ ] Установка зависимостей во время запуска контейнера, а не во время его сборки
- [ ] Добавление команды для удаления временных файлов и кеша после установки зависимостей
- [x] Использование промежуточного образа multi-stage build для установки и сборки всех компонентов и анализ списка устанавливаемых пакетов
- [ ] Объединение всех инструкций `RUN` в один слой для минимизации числа слоев
- [ ] Установление всех зависимостей в одном слое Dockerfile для уменьшения количества слоев и анализ списка устанавливаемых пакетов

#### Вы используете следующий Docker Compose файл:

```yml
version: "3.8"
services:
  api:
    image: myapi:latest
    environment:
      API_KEY: key123
  redis:
    image: redis:latest
```

При запуске контейнеров сервис `арі` не может подключиться к `redis`, а в логах сервиса `арі` фиксируются ошибки соединения с сетью.
Что поможет решить эту проблему?

- [ ] Удаление настройки environment из сервиса `арі` и подключение сервисов к одной сети
- [ ] Смена версии Compose файла на 2.1 и подключение обоих сервисов к одной сети
- [x] Добавление секции `networks` в Compose файл и подключение сервисов к одной сети
- [ ] Перезапуск Compose файл с флагом `--force-recreate` и подключение двух сервисов к одной сети
- [ ] Добавить переменные окружения для сервиса `redis` и подключение обоих сервисов к одной сети

#### Вы настраиваете тестовую среду для приложения, которое использует контейнеры для веб-сервера и Redis (это in-memory база данных, которая часто используется для кэширования). Требуется создать такую конфигурацию, чтобы веб-сервер и Redis могли взаимодействовать друг с другом, но при этом Redis был полностью изолирован от всех остальных контейнеров. Как это сделать?

- [ ] Использовать тип сети `none` для Redis и тип сети `bridge` для веб-сервера
- [ ] Использовать тип сети `host` и запустить Redis с помощью команды `docker run -net=host`
- [ ] Использовать тип сети `bridge` и добавить правило `firewall` для ограничения доступа к Redis
- [ ] Создать сеть overlay и подключить только веб-сервер к этой сети
- [x] Использовать тип сети `bridge` и подключить оба контейнера к одной сети с помощью `docker network connect`

#### Ваша задача:

1. Определить текущие показатели потребления памяти этим контейнером.
2. Проверить лимиты ресурсов, заданные при запуске.
3. Скопировать конфигурационный файл `/etc/app/config.yml` на хост для анализа.

Какой из предложенных наборов команд поможет выполнить задачу?

- [ ] Остановить контейнер с помощью `docker kill`, проанализировать дамп через `docker save` и сохранить из него файл
- [x] Использовать `docker stats` для получения информации об использовании ресурсов, `docker inspect` для анализа лимитов и `docker ср` для копирования конфигурационного файла
- [ ] Использовать `docker ехес` для запуска команды `top`, `docker logs` для просмотра последних ошибок и `docker ср`, чтобы скопировать файл
- [ ] Использовать `docker logs` для поиска утечек по логам, `docker attach` для входа и scp для копирования файла
- [ ] Выполнить `docker kill` для немедленного завершения контейнера, затем `docker export` для сохранения его файловой системы и `docker save` для сохранения файла

#### Вы запустили локальный Docker Registry, но обнаружили, что соединения осуществляются только через НТТР. Это вызывает обеспокоенность по поводу безопасности, особенно в случае работы с конфиденциальными данными. Вы решили настроить HTTPS, чтобы защитить передаваемую информацию.

Что необходимо сделать для обеспечения безопасности соединений?

- [ ] Отключить доступ к Registry из внешней сети, чтобы исключить риски
- [x] Настроить сертификаты SSL/TLS и подключить их к Docker Registry
- [ ] Настроить Firewall для защиты соединений через НТТР
- [ ] Использовать параметр `--insecure-registry` для доступа через НТТР
- [ ] Добавить параметр `--net=host`, чтобы исключить использование НТТР

#### Контейнер cache-server работает нестабильно, но его нужно безопасно завершить с сохранением состояния. Ваша задача:

1. Завершить контейнер корректно, дав приложениям время закрыться.
2. Сохранить его файловую систему в виде нового образа.
3. Перезапустить новый контейнер на основе этого состояния.

Какими командами это можно сделать?

- [ ] Использовать `docker kill` для немедленного завершения, затем `docker save` для сохранения контейнера и `docker analyze` для его анализа
- [x] Завершить работу контейнера через `docker stop`, затем сохранить состояние с помощью `docker commit` и запустить новый контейнер через `docker run`
- [ ] Использовать `docker pause`, затем `docker commit` и потом `docker unpause` для восстановления состояния контейнера
- [ ] Настроить `restart=always` и перезапустить контейнер через `docker start`
- [ ] Войти через `docker ехес` в контейнер, остановить процессы вручную и создать дамп командой `docker export`

#### Какой способ подключения связанного тома для сохранения данных контейнера НЕ поможет для успешной работы с ним?

- [ ] Использование тома, созданного через `docker volume create`, с последующей его привязкой к контейнеру с флагом `-v`
- [x] Использование временной файловой системы `--tmpfs`, где данные хранятся в оперативной памяти
- [ ] Добавление параметра `VOLUME` в Dockerfile для автоматического создания тома без явной привязки
- [ ] Применение bind-монтирования с `--mount type=bind`, привязывая директорию хоста к контейнеру
- [ ] Использование сети для хранения данных через NFS или CIFS, монтируя их в контейнер

#### Вы администрируете систему, где контейнер Nginx используется для хранения логов. Эти логи содержат информацию о действиях пользователей и системных событиях, которые важны для анализа и диагностики. Вам нужно регулярно сохранять их копии в отдельную директорию на хосте, чтобы избежать потери данных при сбое контейнера. Также важно, чтобы процесс резервного копирования не прерывал работу Nginx и оставался полностью автоматизированным.

Выберите подходящий метод.

- [ ] Сохранять логи внутри файловой системы контейнера Nginx без подключения тома
- [ ] Настроить задачу `cron` для автоматического копирования логов из контейнера на хост
- [x] Подключить том Docker к контейнеру Nginx и настроить синхронизацию с хостовой системой
- [ ] Настроить контейнер Nginx в режиме `read-only` для полной защиты данных пользователей
- [ ] Использовать параметр -`-restart=no` для контейнера Nginx, чтобы периодически его перезапускать

#### Какой open-source инструмент подходит для автоматического сбора метрик и имеет удобный и полный интерфейс для анализа?

- [x] Prometheus
- [ ] Telegraf
- [ ] Logstash
- [ ] Elasticsearch
- [ ] Grafana

#### Вы анализируете производительность микросервисного приложения в Docker-контейнерах с использованием Grafana и Elastic Stack. Один из сервисов начал работать медленнее, чем ожидалось, а логи показывают регулярные таймауты. Мониторинг фиксирует высокие задержки при взаимодействии с базой данных: трафик идет через виртуальные интерфейсы bridge-сети Docker и NAT, что дает дополнительную прослойку.

Что произойдет, если заменить стандартную сеть Docker `bridge` на `host`?

- [ ] Проблема лимита подключений к базе данных останется, так как она не связана с типом сети Docker
- [ ] Таймауты при взаимодействии с базой данных могут сохраняться, если проблема связана с ограничением ресурсов хоста
- [ ] Задержки при взаимодействии с базой данных уменьшатся, так как сеть `host` упрощает маршрутизацию
- [ ] Скорость взаимодействия между контейнерами повысится, так как сеть `host` устраняет часть сетевых накладных расходов
- [x] Пропадет возможность изолировать сеть контейнеров, так как сеть `host` напрямую использует сетевые интерфейсы хоста

#### Вы создаете пайплайн CI/CD с использованием Docker и GitLab Cl. На этапе развертывания требуется развернуть контейнеры в тестовой среде.

Как Docker упрощает этот процесс?

- [x] Создает контейнеры из одного образа, минимизируя расхождения в окружениях
- [ ] Исключает необходимость тестирования приложений
- [ ] Исключает настройку сетей между контейнерами
- [ ] Позволяет использовать общие образы для всех этапов пайплайна
- [ ] Автоматически развертывает приложения в продакшн
